{% extends 'bienestar_layout/base_bienestar.html' %}
{% load static %}

{% block content %}
<div class="container">
<div class="card shadow border-0 rounded-4 mb-4 overflow-hidden">
    <div class="bg-gradient-custom text-white p-4 position-relative " style="min-height: 120px;">
        <div class="position-absolute top-0 end-0 p-3  opacity-25">
            <i class="bi bi-people display-1"></i>
        </div>
        <div class="position-relative z-1 d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
            <div>
                <h2 class="fw-bold mb-1">Gesti√≥n de Personas</h2>
                <p class="mb-0 opacity-90">
                    Registro completo de todas las personas del Sistema
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Filtros -->
<div class="content-card mb-4">
    <form method="get" class="row g-3">
        <div class="col-md-5">
            <label class="form-label">Buscar persona</label>
            <input type="text" name="search" class="form-control"
                   placeholder="Nombre, apellido, documento o correo"
                   value="{{ search_query }}">
        </div>

        <div class="col-md-2">
            <label class="form-label">Rol</label>
            <select name="rol" class="form-select">
                <option value="">Todos los roles</option>
                {% for rol_code, rol_name in roles %}
                <option value="{{ rol_code }}" {% if rol_filter == rol_code %}selected{% endif %}>
                    {{ rol_name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
            <label class="form-label">Sede</label>
            <select name="sede" class="form-select">
                <option value="">Todas las sedes</option>
                {% for sede_code, sede_name in sedes %}
                <option value="{{ sede_code }}" {% if sede_filter == sede_code %}selected{% endif %}>
                    {{ sede_name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3 d-flex align-items-end gap-2">
            <button type="submit" class="btn btn-primary flex-fill">
                <i class="bi bi-search me-1"></i>
                Buscar
            </button>
            <a href="{% url 'listar_personas' %}" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i>
            </a>
        </div>
    </form>
</div>

<!-- Lista de personas -->
<div class="content-card">
    {% if personas %}
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>Documento</th>
                <th>Apellido y Nombre</th>

                <th>Sede</th>
                <th>Correo</th>
                <th>Usuario</th>
                <th class="text-end">Acciones</th>
            </tr>
            </thead>
            <tbody>
            {% for persona in personas %}
            <tr>
                <td>
                    <strong>{{ persona.documento }}</strong>
                    <br>
                    <small class="text-muted">{{ persona.get_tipo_documento_display }}</small>
                </td>
                <td>
                    <strong>{{ persona.apellido }}, {{ persona.get_nombre_visible }}</strong>
                    {% if persona.nombre_percibido and persona.nombre_percibido_validado %}
                    <br>
                    <small class="text-success">
                        <i class="bi bi-check-circle"></i>
                        Nombre percibido validado
                    </small>
                    {% endif %}
                </td>
                <td>
                    <small>{{ persona.get_sede_display }}</small>
                </td>
                <td>
                    <small>{{ persona.correo|truncatechars:30 }}</small>
                </td>
                <td>
                    {% if persona.usuario %}
                    <small class="">
                        {{ persona.usuario.username }}
                    </small>
                    {% else %}
                    <span class="badge bg-warning text-dark">
                        <i class="bi bi-exclamation-triangle"></i>
                        Sin usuario
                    </span>
                    {% endif %}
                </td>
                <td class="text-end">
                    <div class="btn-group" role="group">
                        <a href="{% url 'detalle_persona' persona.id %}"
                           class="btn btn-sm btn-outline-primary"
                           title="Ver detalle">
                            <i class="bi bi-eye"></i>
                        </a>
                        <a href="{% url 'editar_persona' persona.id %}"
                           class="btn btn-sm btn-outline-warning"
                           title="Editar">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'eliminar_persona' persona.id %}"
                           class="btn btn-sm btn-outline-danger"
                           title="Eliminar">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="mt-3">
        <p class="text-muted mb-0">
            <i class="bi bi-info-circle me-1"></i>
            Mostrando {{ personas.count }} persona(s)
        </p>
    </div>

    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-person-x" style="font-size: 64px; color: #ccc;"></i>
        <p class="text-muted mt-3">
            {% if search_query or rol_filter or sede_filter %}
            No se encontraron personas con los filtros aplicados
            {% else %}
            No hay personas registradas
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>

</div>

<style>

      :root {
        --primary-custom: #2C7D4B;
        --primary-dark: #1e5c35;
    }

    .bg-gradient-custom {
        background: linear-gradient(135deg, var(--primary-custom) 0%, var(--primary-dark) 100%) !important;
    }

    .text-primary-custom {
        color: var(--primary-custom) !important;
    }

    .content-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .page-title {
        color: #2c3e50;
        font-weight: 600;
    }

    .table th {
        font-weight: 600;
        color: #2c3e50;
        border-bottom: 2px solid #dee2e6;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
    }

    .stat-content h3 {
        margin: 0;
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
    }

    .stat-content p {
        margin: 0;
        font-size: 14px;
        color: #7f8c8d;
    }
</style>
{% endblock %}